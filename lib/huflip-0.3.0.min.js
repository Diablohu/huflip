/* huFlip -----------------------------------------------------------------------------------------------------
 * Inspired by Windows 8

 * v0.3.0
 * Last Update: Jan.7, 2013
 * Diablohu (dreamgen.cn)

 * Visit http://www.dreamgen.cn/huflip for latest version, update history, sample codes and more
 * 访问 http://www.dreamgen.cn/huflip 获取最新版本、了解版本历史、查看示例代码，以及更多
 */

var _huFlip={obj:[],index:0,isInit:!1,timeoutResize:null,cSize:{x:"width",y:"height"},duration:600,animation:[{axis:"y",objStart:{scale:1,perspective:"600px",rotateY:"0deg"},objEnd:{scale:1.2,perspective:"600px",rotateY:"90deg"},overlayStart:{perspective:"1200px",rotateY:"-90deg"},overlayEnd:{scale:1,perspective:"1200px",rotateY:"0deg"},overlayFade:{scale:0,perspective:"1200px",rotateY:"0deg"}},{axis:"y",objStart:{scale:1,perspective:"600px",rotateY:"0deg"},objEnd:{scale:1.2,perspective:"600px",rotateY:"-90deg"},
overlayStart:{perspective:"1200px",rotateY:"90deg"},overlayEnd:{scale:1,perspective:"1200px",rotateY:"0deg"},overlayFade:{scale:0,perspective:"1200px",rotateY:"0deg"}},{axis:"x",objStart:{scale:1,perspective:"600px",rotateX:"0deg"},objEnd:{scale:1.2,perspective:"600px",rotateX:"-90deg"},overlayStart:{perspective:"1200px",rotateX:"90deg"},overlayEnd:{scale:1,perspective:"1200px",rotateX:"0deg"},overlayFade:{scale:0,perspective:"1200px",rotateX:"0deg"}},{axis:"x",objStart:{scale:1,perspective:"600px",
rotateX:"0deg"},objEnd:{scale:1.2,perspective:"600px",rotateX:"90deg"},overlayStart:{perspective:"1200px",rotateX:"-90deg"},overlayEnd:{scale:1,perspective:"1200px",rotateX:"0deg"},overlayFade:{scale:0,perspective:"1200px",rotateX:"0deg"}}],overlayStyle:[{background:"#252525"},{background:"#0a0a0a"},{background:"#1b58b8"},{background:"#b81b1b"},{background:"#15992a"}],_:null};if("undefined"==typeof _tecHu)var _tecHu={};
_tecHu.csscheck||(_tecHu.cssprefix_result={},_tecHu.csscheck=function(a){_tecHu.csscheck_div||(_tecHu.csscheck_div=document.createElement("div"));return a in _tecHu.csscheck_div.style},_tecHu.csscheck_full=function(a){return _tecHu.cssprefix(a,null,!0)},_tecHu.cssprefix=function(a,b,c){if(_tecHu.cssprefix_result[a])var d=_tecHu.cssprefix_result[a];else if(!1===_tecHu.cssprefix_result[a]){if(c)return!1;d=""}else{var d="",e=["-webkit-","-moz-","-ms-","-o-"];if(!_tecHu.csscheck(a))for(var d=!1,f=0;f<
e.length;f++)if(_tecHu.csscheck(e[f]+a)){d=e[f];break}_tecHu.cssprefix_result[a]=d;if(c)return!1===d?!1:!0}d=!1===d?"":d;return b?d:d+a},_tecHu.csscheck_3d=function(){return _tecHu.csscheck_full("perspective")});
_tecHu.addStyleSheet||(_tecHu.addStyleSheet=function(a,b,c){var d="";c=c||_huFlip.sheet;for(var e in b)d=jQuery.browser.msie&&9>parseFloat(jQuery.browser.version)&&"opacity"==e?d+("filter:alpha(opacity="+100*b[e]+")"):d+(_tecHu.cssprefix(e)+":"+b[e]+";");c||(b=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(b),window.createPopup||b.appendChild(document.createTextNode("")),_huFlip.sheet=document.styleSheets[document.styleSheets.length-1],c=_huFlip.sheet);if(c.insertRule)c.insertRule(a+
"{"+d+"}",c.cssRules.length);else{a=a.split(",");for(e=0;e<a.length;e++)c.addRule(a[e],d)}});
function huFlip(a,b,c){a=jQuery(a);if(!a||!a.length||!b)return!1;if(a.data("huFlip"))return this;var d=jQuery.extend(!0,{},this.defaults);jQuery.extend(!0,d,c);jQuery.extend(!0,this,d);"string"==typeof b&&(b=this.isImg?$("<img/>").attr("src",b):this.isIframe?$("<iframe/>").attr("src",b):/\.(jpg|jpeg|png|gif)$/i.test(b)?$("<img/>").attr("src",b):/^([a-z]+\:\/\/)/i.test(b)?$("<iframe/>").attr("src",b):$("<div/>").html(b));this.obj=a;this.el=b;this.index=_huFlip.index;this.objClass="huFlip_obj_"+this.index;
this.objClassEnd="huFlip_obj_"+this.index+"_end";this.animation=_huFlip.animation[this.animation]?this.animation:0;this.durationA=this.duration/4;this.durationB=this.duration-this.durationA;_huFlip.obj.push(this);_huFlip.index++;this.obj.on({click:function(){jQuery(this).huFlip("flip")}})}huFlip.prototype.defaults={el:null,animation:0,duration:_huFlip.duration,overlayStyle:0,isImg:null,isIframe:null,isInit:!1,isShowing:!1,isFliping:!1};
huFlip.prototype.returnTransform=function(a,b,c){c=c||this;if(!c||!a||!b)return!1;a=_huFlip.animation[c.animation][a+b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()]||{};b="";for(var d in a)b+=d+"("+a[d]+") ";return b};
huFlip.prototype.flip=function(a){a=a||this;if(!a||a.isFliping||a.isShowing)return!1;a.isInit||a.init(a);a.isFliping=!0;var b=a.obj,c=a.overlay,d=a.duration,e=a.durationA,f=a.durationB,k=a.objClass,l=a.objClassEnd,j=_huFlip.cSize[_huFlip.animation[a.animation].axis],g={height:b.outerHeight(),width:b.outerWidth(),top:b.offset().top,left:b.offset().left},h={height:jQuery(window).height(),width:jQuery(window).width()},m=g.left+g.width/2-h.width/2,n=g.top+g.height/2-h.height/2,j="scale("+g[j]/h[j]/2+
") "+a.returnTransform("overlay","start");_tecHu.csscheck_3d()?(b.addClass(k).addClass(l),c.css(_tecHu.cssprefix("transition"),"").css({top:n,left:m,opacity:1}).css(_tecHu.cssprefix("transform"),j),a.outbox.css("overflow","hidden"),setTimeout(function(){c.css(_tecHu.cssprefix("transition"),_tecHu.cssprefix("transform")+" "+f/1E3+"s cubic-bezier(0.075, 0.820, 0.165, 1.000),top "+f/1E3+"s cubic-bezier(0.075, 0.820, 0.165, 1.000),left "+f/1E3+"s cubic-bezier(0.075, 0.820, 0.165, 1.000),opacity "+f/1E3+
"s cubic-bezier(0.075, 0.820, 0.165, 1.000)").css({top:0,left:0}).css(_tecHu.cssprefix("transform"),a.returnTransform("overlay","end"))},e),setTimeout(function(){jQuery("body").addClass("huFlipB");b.removeClass(k).removeClass(l);a.outbox.css("overflow","auto");a.isFliping=!1;a.isShowing=!0},d)):c.css({width:g.width,height:g.height,top:g.top,left:g.left,opacity:0}).animate({width:h.width,height:h.height,top:0,left:0,opacity:1},d/2,function(){c.css({width:"100%",height:"100%"});jQuery("body").addClass("huFlipB");
a.isFliping=!1;a.isShowing=!0})};
huFlip.prototype.unflip=function(a){a=a||this;if(!a||a.isFliping||!a.isShowing)return!1;a.isFliping=!0;var b=a.overlay,c=a.durationA,d=a.durationB,e=navigator.userAgent;/Opera/.test(e);e=!/WebKit/.test(e)&&-1!=e.indexOf("Gecko");a.outbox.css("overflow","hidden");_tecHu.csscheck_3d()?(b.css(_tecHu.cssprefix("transform"),a.returnTransform("overlay","fade")).css("opacity",0),setTimeout(function(){b.css(_tecHu.cssprefix("transition"),"");a.isFliping=!1;a.isShowing=!1},d)):b.css({}).animate({width:0,height:0,
top:jQuery(window).height()/2,left:jQuery(window).width()/2,opacity:0},c,function(){a.isFliping=!1;a.isShowing=!1});e?setTimeout(function(){jQuery("body").removeClass("huFlipB")},50):jQuery("body").removeClass("huFlipB")};huFlip.prototype.unflipAll=function(){for(var a=0;a<_huFlip.obj.length;a++){var b=_huFlip.obj[a];b.isInit&&b.unflip()}};
huFlip.prototype.initGlobal=function(){if(_huFlip.isInit)return!1;var a=this,b={"html.huFlipH":{"min-height":"100% !important"},"body.huFlipB":{overflow:"hidden"},".huFlipO":{position:"fixed",top:"0px",left:"0px",width:"100%",height:"100%","z-index":"100000","max-width":"100%",overflow:"hidden",color:"#fff",border:"0",padding:"0",margin:"0","backface-visibility":"hidden"},".huFlipOCB":{display:"block",position:"absolute","z-index":"9999",width:"30px",height:"30px","line-height":"30px",top:"5px",left:"5px",
"text-align":"center","font-size":"20px","font-family":"Arial",opacity:"0.35",color:"#fff",background:"#999",border:"1px solid #fff","text-decoration":"none"},".huFlipOCB:hover":{opacity:"0.65",color:"#fff","text-decoration":"none"},".huFlipOCB:active":{opacity:"0.25",color:"#fff","text-decoration":"none"},".huFlipOO":{width:"100%",height:"100%",display:"inline-block",position:"relative","z-index":1,"text-align":"center",overflow:"hidden",border:"0",padding:"0",margin:"0","margin-top":jQuery.browser.msie&&
8>parseFloat(jQuery.browser.version)?"-8px":"0","vertical-align":"middle"},".huFlipOO:before":{content:'""',display:"inline-block",width:0,height:"100%","vertical-align":"middle"},".huFlipOC, .huFlipOO > img, .huFlipOO > iframe":{display:"inline-block","max-width":"100%","max-height":"100%",border:"0",padding:"0",margin:"0",height:"auto",width:"auto","vertical-align":"middle"},".huFlipOO > img":{"max-height":"97.5%","max-width":"97.5%"},".huFlipOO > iframe":{height:"97.5%",width:"97.5%"}},c;for(c in b)_tecHu.addStyleSheet(c,
b[c]);jQuery("html").addClass("huFlipH").off("keyup.huFlip").on({"keyup.huFlip":function(b){switch(window.event?b.keyCode:b.which){case 27:a.unflipAll()}}});jQuery(window).off("resize.huFlip").on({"resize.huFlip":function(){if(_huFlip.timeoutResize)return!0;_huFlip.timeoutResize=setTimeout(function(){for(var a=0;a<_huFlip.obj.length;a++){var b=_huFlip.obj[a];b&&_huFlip.isShowing&&b.overlay.css({height:jQuery(window).height(),top:parseInt(jQuery("body").scrollTop())+"px",left:parseInt(jQuery("body").scrollLeft())+
"px"})}_huFlip.timeoutResize=null},1)}});_huFlip.isInit=!0};
huFlip.prototype.init=function(a){a=a||this;if(!a||a.isInit)return!1;var b="."+a.objClassEnd,c={};c["."+a.objClass]={transform:a.returnTransform("obj","start"),transition:_tecHu.cssprefix("transform")+" "+a.durationA/1E3+"s linear"};c[b]={transform:a.returnTransform("obj","end")};for(var d in c)_tecHu.addStyleSheet(d,c[d]);b=_huFlip.overlayStyle[a.overlayStyle]||a.overlayStyle;_tecHu.csscheck_3d()&&(b[_tecHu.cssprefix("transform")]=a.returnTransform("overlay","start"));a.overlay=jQuery("<div />").addClass("huFlipO").css(b).appendTo(jQuery("body"));
a.outbox=jQuery("<div/>").addClass("huFlipOO").appendTo(a.overlay);a.container=jQuery("<div/>").addClass("huFlipOC").appendTo(a.outbox);a.btnClose=jQuery("<a/>").attr("href","javascript:;").addClass("huFlipOCB").html("X").on({click:function(){a.unflip()}}).appendTo(this.overlay);a.el&&a.el.length&&a.el.appendTo(a.container);1==a.el.length&&("IMG"==a.el[0].tagName||"IFRAME"==a.el[0].tagName)&&a.el.appendTo(a.outbox);a.isInit=!0;a.initGlobal()};
(function(a){a.fn.huFlip=function(){var b=a.fn.huFlip.arguments;if(i=this.data("huFlip")){if(b)if("string"==typeof b[0])if(1<b.length)if("callback"==b[0]){if(i.callback[b[1]])i.callback[b[1]](i.dom)}else{var c={},d;for(d in b)c[b[d]]=i[b[d]];return c}else switch(b[0]){case "flip":i.flip();break;default:return i[b[0]]}else if("object"==typeof b[0]){c={};for(d in b[0])c[b[0][d]]=i[b[0][d]];return c}return i}this.each(function(){if(b){var c=b[0],d=b[1]||{};a(this).data("huFlip",new huFlip(a(this),c,
d))}});return this};a.fn.huflip=a.fn.huFlip})(jQuery);